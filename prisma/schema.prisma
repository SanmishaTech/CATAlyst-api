generator client {
  provider = "prisma-client-js"
  log      = ["query", "error", "warn", "info"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                        Int                       @id @default(autoincrement())
  name                      String
  email                     String                    @unique
  password                  String
  role                      String
  clientId                  Int?
  active                    Boolean                   @default(true)
  lastLogin                 DateTime?
  resetToken                String?
  resetTokenExpires         DateTime?
  apiKey                    String?                   @unique
  apiKeyExpiry              DateTime?
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  batches                   Batch[]
  executions                Execution[]
  orders                    Order[]
  client                    Client?                   @relation("ClientUsers", fields: [clientId], references: [id], onDelete: Cascade)
  validationSchemaHistories ValidationSchemaHistory[]

  @@index([clientId])
  @@map("users")
}

model Client {
  id                        Int                       @id @default(autoincrement())
  name                      String
  entityName                String?
  address                   String?                   @db.Text
  legalAddress              String?                   @db.Text
  taxOrEinNumber            String?
  mpid                      String?
  lei                       String?
  catReporterImid           String?
  catSubmitterImid          String?
  contactPersonName         String?
  contactNumber             String?
  contactEmailId            String?
  serviceEmailId            String?
  catEnabled                Boolean                   @default(false)
  sixZeroFiveEnabled        Boolean                   @default(false)
  loprEnabled               Boolean                   @default(false)
  supportEscalationContact  String?
  dataSpecificationModel    String?
  configurationPlaceholder  String?
  configurationPlaceholder1 String?
  configurationPlaceholder2 String?
  placeholderColumn1        String?
  placeholderColumn2        String?
  placeholderColumn3        String?
  placeholderColumn4        String?
  placeholderColumn5        String?
  placeholderColumn6        String?
  placeholderColumn7        String?
  validation_1              Json?
  exe_validation_1          Json?
  validation_2              Json?
  exe_validation_2          Json?
  validation_3              Json?
  exe_validation_3          Json?
  active                    Boolean                   @default(true)
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  users                     User[]                    @relation("ClientUsers")
  validationSchemaHistories ValidationSchemaHistory[]
  usBrokerDealers           USBrokerDealer[]          @relation("ClientUSBrokerDealers")
  instrumentMappings        InstrumentsMapping[]      @relation("ClientInstrumentMappings")
  accountMappings           AccountMapping[]          @relation("ClientAccountMappings")
  currencyCodes             CurrencyCode[]            @relation("ClientCurrencyCodes")
  firmEntities              FirmEntity[]              @relation("ClientFirmEntities")

  @@map("clients")
}

model Batch {
  id                 Int                 @id @default(autoincrement())
  userId             Int
  totalOrders        Int                 @default(0)
  successfulOrders   Int                 @default(0)
  failedOrders       Int                 @default(0)
  status             String              @default("pending")
  fileName           String?             @db.VarChar(255)
  tradeDate          DateTime?
  fileType           String?
  errorLog           String?             @db.Text
  validation_1       Boolean?
  validation_1_status String?             @db.VarChar(50) // "passed" or "failed"
  validation_2       Boolean?
  validation_2_status String?             @db.VarChar(50) // "passed" or "failed"
  validation_3       Boolean?
  validation_3_status String?             @db.VarChar(50) // "passed" or "failed"
  importedAt         DateTime            @default(now())
  completedAt        DateTime?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  executions         Execution[]
  orders             Order[]
  rejectedExecutions RejectedExecution[]
  rejectedOrders     RejectedOrder[]
  validationErrors   ValidationError[]
  validations        Validation[]

  @@index([userId])
  @@index([validation_1])
  @@index([validation_2])
  @@index([validation_3])
  @@map("batches")
}

model Validation {
  id          Int               @id @default(autoincrement())
  orderId     Int?
  executionId Int?
  batchId     Int
  success     Boolean           @default(false)
  validatedAt DateTime          @default(now())
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  errors      ValidationError[]
  batch       Batch             @relation(fields: [batchId], references: [id], onDelete: Cascade)
  execution   Execution?        @relation(fields: [executionId], references: [id], onDelete: Cascade)
  order       Order?            @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([executionId])
  @@index([batchId])
  @@map("validations")
}

model ValidationError {
  id              Int        @id @default(autoincrement())
  validationId    Int
  batchId         Int
  orderId         Int?
  executionId     Int?
  validationCode  String     @db.VarChar(100)
  validationLevel Int        @default(1) // 1, 2, or 3 to track which validation this error belongs to
  field           String     @db.VarChar(255)
  message         String     @db.Text
  code            String     @db.VarChar(100)
  is_deduped      Int        @default(0)
  is_validated    Int        @default(0)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  batch           Batch      @relation(fields: [batchId], references: [id], onDelete: Cascade)
  execution       Execution? @relation(fields: [executionId], references: [id], onDelete: Cascade)
  order           Order?     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  validation      Validation @relation(fields: [validationId], references: [id], onDelete: Cascade)

  @@index([validationId])
  @@index([batchId])
  @@index([orderId])
  @@index([executionId])
  @@index([batchId, createdAt])
  @@index([code])
  @@index([validationCode])
  @@index([validationLevel])
  @@index([createdAt])
  @@index([is_deduped])
  @@index([is_validated])
  @@map("validation_errors")
}

model Order {
  id                            Int               @id @default(autoincrement())
  userId                        Int
  batchId                       Int
  clientId                      String?
  uniqueID                      String            @db.VarChar(256)
  orderId                       String            @db.VarChar(128)
  orderIdVersion                Int?
  orderIdSession                String?           @db.VarChar(16)
  orderIdInstance               String?           @db.VarChar(64)
  parentOrderId                 String?           @db.VarChar(128)
  cancelreplaceOrderId          String?           @db.VarChar(128)
  linkedOrderId                 String?           @db.VarChar(128)
  linkOrderType                 String?           @db.VarChar(128)
  orderAction                   String            @db.VarChar(50)
  orderStatus                   String?           @db.VarChar(48)
  orderCapacity                 String            @db.VarChar(48)
  orderDestination              String?           @db.VarChar(48)
  orderClientRef                String?           @db.VarChar(128)
  orderClientRefDetails         String?           @db.VarChar(48)
  orderExecutingEntity          Int?
  orderBookingEntity            Int?
  orderPositionAccount          Int?
  orderSide                     String            @db.VarChar(50)
  orderClientCapacity           String?           @db.VarChar(50)
  orderManualIndicator          String?           @db.VarChar(50)
  orderRequestTime              String?           @db.VarChar(50)
  orderEventTime                String?           @db.VarChar(50)
  orderManualTimestamp          String?           @db.VarChar(50)
  orderOmsSource                String            @db.VarChar(64)
  orderPublishingTime           String            @db.VarChar(50)
  orderTradeDate                String?           @db.VarChar(50)
  orderQuantity                 Decimal?          @db.Decimal(18, 6)
  orderPrice                    Decimal?          @db.Decimal(18, 6)
  orderType                     String            @db.VarChar(50)
  orderTimeInforce              String?           @db.VarChar(50)
  orderExecutionInstructions    String?           @db.VarChar(128)
  orderAttributes               String?           @db.VarChar(128)
  orderRestrictions             String?           @db.VarChar(256)
  orderAuctionIndicator         String?           @db.VarChar(64)
  orderSwapIndicator            String?           @db.VarChar(50)
  orderOsi                      String?           @db.VarChar(128)
  orderInstrumentId             Int?
  orderLinkedInstrumentId       Int?
  orderCurrencyId               String?           @db.VarChar(32)
  orderFlowType                 String?           @db.VarChar(32)
  orderAlgoInstruction          String?           @db.VarChar(64)
  orderSymbol                   String?           @db.VarChar(64)
  orderInstrumentReference      String?           @db.VarChar(24)
  orderInstrumentReferenceValue String?           @db.VarChar(64)
  orderOptionPutCall            String?           @db.VarChar(50)
  orderOptionStrikePrice        Decimal?          @db.Decimal(18, 6)
  orderOptionLegIndicator       String?           @db.VarChar(50)
  orderComplianceId             String            @db.VarChar(128)
  orderEntityId                 String?           @db.VarChar(128)
  orderExecutingAccount         Int?
  orderClearingAccount          Int?
  orderClientOrderId            String?           @db.VarChar(128)
  orderRoutedOrderId            String?           @db.VarChar(128)
  orderTradingOwner             Int?
  orderExtendedAttribute        String?           @db.VarChar(256)
  orderQuoteId                  String?           @db.VarChar(128)
  orderRepresentOrderId         String?           @db.VarChar(128)
  orderOnBehalfCompId           String?           @db.VarChar(64)
  orderSpread                   Decimal?          @db.Decimal(18, 6)
  orderAmendReason              String?           @db.VarChar(64)
  orderCancelRejectReason       String?           @db.VarChar(64)
  orderBidSize                  Decimal?          @db.Decimal(18, 6)
  orderBidPrice                 Decimal?          @db.Decimal(18, 6)
  orderAskSize                  Decimal?          @db.Decimal(18, 6)
  orderAskPrice                 Decimal?          @db.Decimal(18, 6)
  orderNetPrice                 Decimal?          @db.Decimal(18, 6)
  orderBasketId                 String?           @db.VarChar(128)
  orderCumQty                   Decimal?          @db.Decimal(18, 6)
  orderLeavesQty                Decimal?          @db.Decimal(18, 6)
  orderStopPrice                Decimal?          @db.Decimal(18, 6)
  orderDiscretionPrice          Decimal?          @db.Decimal(18, 6)
  orderExdestinationInstruction String?           @db.VarChar(64)
  orderExecutionParameter       String?           @db.VarChar(128)
  orderInfobarrierId            String?           @db.VarChar(128)
  orderLegRatio                 Decimal?          @db.Decimal(18, 6)
  orderLocateId                 String?           @db.VarChar(128)
  orderNegotiatedIndicator      String?           @db.VarChar(50)
  orderOpenClose                String?           @db.VarChar(50)
  orderParticipantPriorityCode  String?           @db.VarChar(32)
  orderActionInitiated          String?           @db.VarChar(32)
  orderPackageIndicator         String?           @db.VarChar(50)
  orderPackageId                String?           @db.VarChar(128)
  orderPackagePricetype         String?           @db.VarChar(64)
  orderStrategyType             String?           @db.VarChar(64)
  orderSecondaryOffering        String?           @db.VarChar(50)
  orderStartTime                String?           @db.VarChar(50)
  orderTifExpiration            String?           @db.VarChar(50)
  orderParentChildType          String?           @db.VarChar(50)
  orderMinimumQty               Decimal?          @db.Decimal(18, 6)
  orderTradingSession           String?           @db.VarChar(50)
  orderDisplayPrice             Decimal?          @db.Decimal(18, 6)
  orderSeqNumber                String?           @db.VarChar(128)
  atsDisplayIndicator           String?           @db.VarChar(50)
  orderDisplayQty               Decimal?          @db.Decimal(18, 6)
  orderWorkingPrice             Decimal?          @db.Decimal(18, 6)
  atsOrderType                  String?           @db.VarChar(32)
  orderNbboSource               String?           @db.VarChar(64)
  orderNbboTimestamp            String?           @db.VarChar(50)
  orderSolicitationFlag         String?           @db.VarChar(50)
  routeRejectedFlag             String?           @db.VarChar(50)
  orderOriginationSystem        String            @db.VarChar(64)
  createdAt                     DateTime          @default(now())
  updatedAt                     DateTime          @updatedAt
  batch                         Batch             @relation(fields: [batchId], references: [id], onDelete: Cascade)
  user                          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  validationErrors              ValidationError[]
  validations                   Validation[]
  businessClassifications       OrderBusinessClassification[]
  orderCatEvents          OrderCatEvent[]

  @@index([userId])
  @@index([batchId])
  @@index([orderId])
  @@index([uniqueID])
  @@index([userId, createdAt])
  @@index([batchId, createdAt])
  @@index([clientId, createdAt])
  @@index([orderSymbol])
  @@index([orderStatus])
  @@index([orderSide])
  @@index([userId, orderStatus])
  @@index([clientId])
  @@index([batchId, id])
  @@map("orders")
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  email     String
  otp       String
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([otp])
  @@map("password_resets")
}

model RejectedOrder {
  id               Int      @id @default(autoincrement())
  batchId          Int
  userId           Int
  rowNumber        Int?
  jsonIndex        Int?
  orderId          String?  @db.VarChar(128)
  rawData          String?  @db.LongText
  validationErrors String   @db.LongText
  uploadType       String   @db.VarChar(10)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  batch            Batch    @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([userId])
  @@index([orderId])
  @@map("rejected_orders")
}

model RejectedExecution {
  id               Int      @id @default(autoincrement())
  batchId          Int
  userId           Int
  rowNumber        Int?
  jsonIndex        Int?
  executionId      String?  @db.VarChar(128)
  rawData          String?  @db.LongText
  validationErrors String   @db.LongText
  uploadType       String   @db.VarChar(10)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  batch            Batch    @relation(fields: [batchId], references: [id], onDelete: Cascade)

  @@index([batchId])
  @@index([userId])
  @@index([executionId])
  @@map("rejected_executions")
}

model Execution {
  id                                Int               @id @default(autoincrement())
  userId                            Int
  batchId                           Int
  clientId                          String?
  uniqueID                          String            @db.VarChar(256)
  executionId                       String            @db.VarChar(128)
  previousExecutionId               String?           @db.VarChar(128)
  executionEntityId                 String            @db.VarChar(128)
  executionVersion                  Int?
  executionSeqNumber                String            @db.VarChar(128)
  externalExecutionId               String?           @db.VarChar(128)
  executionSide                     String            @db.VarChar(50)
  executionPostingSide              String            @db.VarChar(50)
  executionAllocationSide           String?           @db.VarChar(50)
  executionBrokerCapacity           String            @db.VarChar(50)
  executionCapacity                 String            @db.VarChar(50)
  executionEventTime                String            @db.VarChar(50)
  executionTime                     String            @db.VarChar(50)
  executionManualIndicator          String            @db.VarChar(50)
  executionManualEventTime          String?           @db.VarChar(50)
  isMarketExecution                 String            @db.VarChar(50)
  executionLastMarket               String?           @db.VarChar(48)
  executionAccount                  Int
  executionBookingAccount           Int?
  executionBookingEntity            Int?
  executionTradingEntity            Int?
  executionDeskId                   String?           @db.VarChar(48)
  executionOsi                      String?           @db.VarChar(128)
  executionInstrumentId             Int?
  executionLinkedInstrumentId       Int?
  executionSymbol                   String            @db.VarChar(64)
  executionInstrumentReference      String?           @db.VarChar(24)
  executionInstrumentReferenceValue String?           @db.VarChar(64)
  executionLastPrice                Decimal           @db.Decimal(18, 6)
  executionLastQuantity             Decimal           @db.Decimal(18, 6)
  executionContraBroker             String?           @db.VarChar(48)
  linkedExecutionId                 String?           @db.VarChar(128)
  executionTransactionType          String            @db.VarChar(50)
  executionIdInstance               String            @db.VarChar(64)
  executionSession                  String?           @db.VarChar(16)
  executionOrderIdInstance          String?           @db.VarChar(64)
  executionOrderIdSession           String?           @db.VarChar(16)
  executonOrderId                   String            @db.VarChar(128)
  executionOrderIdVersion           Int?
  executionTradeExecutionSystem     String            @db.VarChar(64)
  executionOmsSource                String            @db.VarChar(64)
  executionBookingEligiblity        String?           @db.VarChar(50)
  executionTradeDate                String            @db.VarChar(50)
  executionCurrencyId               String            @db.VarChar(32)
  executionPositionId               Int?
  executionSwapIndicator            String?           @db.VarChar(50)
  executionSettleDate               String?           @db.VarChar(50)
  executionCommisionFee             Decimal?          @db.Decimal(18, 6)
  executionRollupId                 String?           @db.VarChar(128)
  executionSecondaryOffering        String            @db.VarChar(50)
  executionCumQuantity              Decimal?          @db.Decimal(18, 6)
  executionTradeFactors             Decimal?          @db.Decimal(18, 6)
  executionRiskDate                 String?           @db.VarChar(50)
  executionOrderComplianceId        String            @db.VarChar(128)
  executionInfoBarrierId            String?           @db.VarChar(128)
  executonSessionActual             String?           @db.VarChar(50)
  executionStrategy                 String?           @db.VarChar(64)
  executionLastLiquidityIndicator   String?           @db.VarChar(50)
  executionWaiverIndicator          String?           @db.VarChar(50)
  executionLifecycleType            String?           @db.VarChar(50)
  executionPackageIndicator         String?           @db.VarChar(50)
  executionRawLiquidityIndicator    String?           @db.VarChar(50)
  executionPackageId                String?           @db.VarChar(128)
  executionQuoteId                  String?           @db.VarChar(128)
  executionYield                    Decimal?          @db.Decimal(18, 6)
  executionSpread                   Decimal?          @db.Decimal(18, 6)
  executionNegotiatedIndicator      String?           @db.VarChar(50)
  executionOpenCloseIndicator       String?           @db.VarChar(50)
  exchangeExecId                    String?           @db.VarChar(128)
  executionAction                   String            @db.VarChar(50)
  executionCrossId                  String?           @db.VarChar(128)
  executionExecutingEntity          Int?
  createdAt                         DateTime          @default(now())
  updatedAt                         DateTime          @updatedAt
  batch                             Batch             @relation(fields: [batchId], references: [id], onDelete: Cascade)
  user                              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  validationErrors                  ValidationError[]
  validations                       Validation[]
  businessClassifications           ExecutionBusinessClassification[]
  executionCatEvents          ExecutionCatEvent[]

  @@index([userId])
  @@index([batchId])
  @@index([executionEntityId])
  @@index([executionSeqNumber])
  @@index([userId, createdAt])
  @@index([batchId, createdAt])
  @@index([clientId, createdAt])
  @@index([executionSymbol])
  @@index([clientId])
  @@index([uniqueID])
  @@map("executions")
}

model ValidationSchemaHistory {
  id             Int      @id @default(autoincrement())
  clientId       Int
  fileType       FileType @default(ORDER)
  validationType Int
  schema         String   @db.LongText
  changedBy      Int?
  createdAt      DateTime @default(now())
  user           User?    @relation(fields: [changedBy], references: [id])
  client         Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([validationType])
  @@index([fileType])
  @@index([changedBy], map: "validation_schema_history_changedBy_fkey")
  @@map("validation_schema_history")
}

enum FileType {
  ORDER
  EXECUTION
}

model OrderBusinessClassification {
  id                     Int       @id @default(autoincrement())
  orderId                Int
  uniqueID               String    @db.VarChar(256)
  businessClassification String    @db.VarChar(128)
  businessGroup          String    @db.VarChar(128)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  order                  Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)

  orderCatEvents          OrderCatEvent[]
  @@index([orderId])
  @@index([uniqueID])
  @@index([businessClassification])
  @@index([businessGroup])
  @@map("order_business_classifications")
}

model ExecutionBusinessClassification {
  id                     Int       @id @default(autoincrement())
  executionId            Int
  uniqueID               String    @db.VarChar(256)
  businessClassification String    @db.VarChar(128)
  businessGroup          String    @db.VarChar(128)
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  execution              Execution @relation(fields: [executionId], references: [id], onDelete: Cascade)

  executionCatEvents          ExecutionCatEvent[]

  @@index([executionId])
  @@index([uniqueID])
  @@index([businessClassification])
  @@index([businessGroup])
  @@map("execution_business_classifications")
}

model USBrokerDealer {
  id                  Int      @id @default(autoincrement())
  clientRefId         Int?
  clientId            String?  @db.VarChar(128)
  firmName            String?  @db.VarChar(255)
  imid                String?  @db.VarChar(64)
  crdId               String?  @db.VarChar(64)
  exchangeId          String?  @db.VarChar(64)
  foreignBrokerDealer Boolean  @default(false)
  micValue            String?  @db.VarChar(32)
  address             String?  @db.Text
  taxId               String?  @db.VarChar(64)
  lei                 String?  @db.VarChar(64)
  validFrom           DateTime? @db.Date
  validTo             DateTime? @db.Date
  activeFlag          Boolean  @default(true)
  membershipType      String?  @db.VarChar(64)
  account             String?  @db.VarChar(128)
  clearingAccount     String?  @db.VarChar(128)
  clearingBroker      String?  @db.VarChar(128)
  clearingType        String?  @db.VarChar(64)
  region              String?  @db.VarChar(64)
  brokerDealer        Boolean  @default(false)
  atsFlag             Boolean  @default(false)
  defaultImidFlag     Boolean  @default(false)
  destinationCode     String?  @db.VarChar(64)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  client              Client?  @relation("ClientUSBrokerDealers", fields: [clientRefId], references: [id], onDelete: Cascade)

  @@index([clientRefId])
  @@index([clientId])
  @@index([destinationCode])
  @@map("us_broker_dealer")
}

model AccountMapping {
  id             Int       @id @default(autoincrement())
  clientRefId    Int
  clientId       String?   @db.VarChar(128)
  accountNo      String?   @db.VarChar(128)
  accountType    String?   @db.VarChar(64)
  clearingType   String?   @db.VarChar(64)
  desk           String?   @db.VarChar(128)
  infoBarrier    String?   @db.VarChar(128)
  owner          String?   @db.VarChar(255)
  entity         String?   @db.VarChar(255)
  settlementType String?   @db.VarChar(64)
  clearingBroker String?   @db.VarChar(128)
  agreement      Boolean?
  agreementType  String?   @db.VarChar(128)
  primaryParty   String?   @db.VarChar(255)
  counterParty   String?   @db.VarChar(255)
  active     Boolean?
  validFrom      DateTime? @db.Date
  validTo        DateTime? @db.Date
  region         String?   @db.VarChar(64)
  updatedBy      String?   @db.VarChar(255)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  client         Client   @relation("ClientAccountMappings", fields: [clientRefId], references: [id], onDelete: Cascade)

  @@index([clientRefId])
  @@index([clientId])
  @@index([accountNo])
  @@map("account_mappings")
}

model CurrencyCode {
  id          Int      @id @default(autoincrement())
  clientRefId Int?
  clientId    String?  @db.VarChar(128)
  country     String?  @db.VarChar(128)
  currency    String?  @db.VarChar(128)
  code        String?  @db.VarChar(16)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  client      Client?  @relation("ClientCurrencyCodes", fields: [clientRefId], references: [id], onDelete: Cascade)

  @@index([clientRefId])
  @@index([clientId])
  @@index([code])
  @@map("iso_4217_currency_codes")
}

model InstrumentsMapping {
  id               Int      @id @default(autoincrement())
  clientRefId      Int?
  instrumentId     String?  @db.VarChar(128)
  symbol          String?  @db.VarChar(128)
  description     String?  @db.VarChar(255)
  cfiCode         String?  @db.VarChar(32)
  ticker          String?  @db.VarChar(64)
  country         String?  @db.VarChar(64)
  tradeCurrency   String?  @db.VarChar(32)
  osiSymbol       String?  @db.VarChar(128)
  finraTicker     String?  @db.VarChar(128)
  typeCode        String?  @db.VarChar(64)
  exerciseType    String?  @db.VarChar(32)
  strikePrice     Decimal? @db.Decimal(18, 6)
  placement       String?  @db.VarChar(128)
  isin            String?  @db.VarChar(32)
  cusp            String?  @db.VarChar(32)
  sedol           String?  @db.VarChar(32)
  bbgcodeFigi     String?  @db.VarChar(64)
  ric             String?  @db.VarChar(64)
  expirationDate  DateTime?
  contractSize    Int?
  underlyingSymbol String? @db.VarChar(128)
  validFrom       DateTime? @db.Date
  validTo         DateTime? @db.Date
  active          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  client          Client?  @relation("ClientInstrumentMappings", fields: [clientRefId], references: [id], onDelete: Cascade)

  @@index([clientRefId])
  @@index([instrumentId])
  @@index([symbol])
  @@index([ticker])
  @@index([ric])
  @@index([isin])
  @@index([cfiCode])
  @@map("instruments_mapping")
}

model FirmEntity {
  id              Int       @id @default(autoincrement())
  clientRefId     Int
  firmId          Int
  firmName        String?   @db.VarChar(255)
  imid            String?   @db.VarChar(64)
  crdId           String?   @db.VarChar(64)
  address         String?   @db.Text
  taxId           String?   @db.VarChar(64)
  lei             String?   @db.VarChar(64)
  validFrom       DateTime? @db.Date
  validTo         DateTime? @db.Date
  activeFlag      Boolean?   
  type            String?   @db.VarChar(64)
  account         String?   @db.VarChar(128)
  clearingAccount String?   @db.VarChar(128)
  clearingBroker  String?   @db.VarChar(128)
  clearingType    String?   @db.VarChar(64)
  region          String?   @db.VarChar(64)
  brokerDealer    Boolean?   
  affiliateFlag   Boolean?  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  client          Client   @relation("ClientFirmEntities", fields: [clientRefId], references: [id], onDelete: Cascade)

  @@index([clientRefId])
  @@index([firmId])
  @@map("firm_entity")
}




model OrderCatEvent {
  id                     Int   @id @default(autoincrement())
  orderBusinessClassificationId Int
  uniqueID               String    @db.VarChar(256)
  orderRefId                Int
  orderIdInstance Int
  catEvent               String    @db.VarChar(50)

  actionType             String?
  errorROEID             Int?
  firmROEID              String?   @db.VarChar(64)
  type                   String?    @db.VarChar(50)
  CATreporterIMID        String?
  orderKeyDate           DateTime?
  orderID                String?    @db.VarChar(64)
  symbol                 String?
  eventTimestamp         DateTime?

  manualFlag             Boolean?
  electronicdupFlag      Boolean?
  electronicTimestamp    DateTime?
  manualOrderKeyDate     DateTime?
  manualOrderID          String?   @db.VarChar(64)

  deptType               String?
  solicitationFlag       Boolean?
  RFQID                  String?   @db.VarChar(64)

  side                   String?
  price                  Decimal?
  quantity               Decimal?
  minQty                 Int?

  orderType              String?
  timeInForce            Json?
  tradingSession         String?
  handlingInstructions   Json?

  custDspIntrFlag        Boolean?
  firmDesignatedID       String?   @db.VarChar(40)
  accountHolderType      String?
  affiliateFlag          Boolean?
  infoBarrierID          String?   @db.VarChar(20)

  aggregatedOrders       Json?
  AO_orderID             String?   @db.VarChar(64)
  AO_orderKeyDate        DateTime?
  AO_quantity            Decimal?
  AO_originatingIMID     String?

  negotiatedTradeFlag    Boolean?
  representativeInd      String?
  seqNum                 String?    @db.VarChar(40)

  atsDisplayInd          String?
  displayPrice           Decimal?
  workingPrice           Decimal?
  displayQty             Int?

  atsOrderType           Json?

  nbbPrice               Decimal?
  nbbQty                 Int?
  nboPrice               Decimal?
  nboQty                 Int?
  nbboSource             String?
  nbboTimestamp          DateTime?

  netPrice               Decimal?
  BFMMFlag               Boolean?

  originatingIMID        String?
  senderIMID             String?
  destination             String?
  destinationType        String?

  routedOrderID          String?   @db.VarChar(64)
  session                String?   @db.VarChar(40)
  isoInd                 String?
  routeRejectedFlag      Boolean?
  dupROIDCond            Boolean?
  multiLegInd            Boolean?

  pairedOrderID          String?   @db.VarChar(64)
  quoteKeyDate           DateTime?
  quoteID                String?   @db.VarChar(64)

  priorOrderKeyDate      DateTime?
  priorOrderID           String?   @db.VarChar(64)

  receiverIMID           String?
  senderType             String?

  requestTimestamp       DateTime?
  initiator              String?

  leavesQty              Decimal?
  cancelQty              Decimal?

  tradeKeyDate           DateTime?
  tradeID                String?   @db.VarChar(64)

  cancelFlag             Boolean?
  cancelTimestamp        DateTime?

  capacity               String?
  tapeTradeID            String?   @db.VarChar(40)
  marketCenterID         String?

  sideDetailsInd         String?
  buyDetails             Json?
  sellDetails            Json?

  reportingExceptionCode String?
  clearingFirm           Int?
  counterparty           String?

  fillKeyDate            DateTime?
  fulfillmentID          String?   @db.VarChar(64)
  fulfillmentLinkType    String?

  clientDetails          Json?
  firmDetails            Json?

  order                  Order     @relation(fields: [orderRefId], references: [id], onDelete: Cascade)


  orderBusinessClassification          OrderBusinessClassification   @relation( fields: [orderBusinessClassificationId], references: [id], onDelete: Cascade)

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt


  @@index([orderRefId])
  @@index([orderBusinessClassificationId])
  @@map("order_cat_events")
}


model ExecutionCatEvent {
  id                     Int   @id @default(autoincrement())
  executionBusinessClassificationId Int
  uniqueID               String    @db.VarChar(256)
  executionId                Int
  executionIdInstance Int
  catEvent               String    @db.VarChar(50)

  actionType             String?
  errorROEID             Int?
  firmROEID              String?   @db.VarChar(64)
  type                   String    @db.VarChar(50)
  CATreporterIMID        String?
  orderKeyDate           DateTime?
  orderID                String?  @db.VarChar(64)
  symbol                 String?
  eventTimestamp         DateTime?

  manualFlag             Boolean?
  electronicdupFlag      Boolean?
  electronicTimestamp    DateTime?
  manualOrderKeyDate     DateTime?
  manualOrderID          String?   @db.VarChar(64)

  deptType               String?
  solicitationFlag       Boolean?
  RFQID                  String?   @db.VarChar(64)

  side                   String?
  price                  Decimal?
  quantity               Decimal?
  minQty                 Int?

  orderType              String?
  timeInForce            Json?
  tradingSession         String?
  handlingInstructions   Json?

  custDspIntrFlag        Boolean?
  firmDesignatedID       String?   @db.VarChar(40)
  accountHolderType      String?
  affiliateFlag          Boolean?
  infoBarrierID          String?   @db.VarChar(20)

  aggregatedOrders       Json?
  AO_orderID             String?   @db.VarChar(64)
  AO_orderKeyDate        DateTime?
  AO_quantity            Decimal?
  AO_originatingIMID     String?

  negotiatedTradeFlag    Boolean?
  representativeInd      String?
  seqNum                 String?    @db.VarChar(40)

  atsDisplayInd          String?
  displayPrice           Decimal?
  workingPrice           Decimal?
  displayQty             Int?

  atsOrderType           Json?

  nbbPrice               Decimal?
  nbbQty                 Int?
  nboPrice               Decimal?
  nboQty                 Int?
  nbboSource             String?
  nbboTimestamp          DateTime?

  netPrice               Decimal?
  BFMMFlag               Boolean?

  originatingIMID        String?
  senderIMID             String?
  destination             String?
  destinationType        String?

  routedOrderID          String?   @db.VarChar(64)
  session                String?   @db.VarChar(40)
  isoInd                 String?
  routeRejectedFlag      Boolean?
  dupROIDCond            Boolean?
  multiLegInd            Boolean?

  pairedOrderID          String?   @db.VarChar(64)
  quoteKeyDate           DateTime?
  quoteID                String?   @db.VarChar(64)

  priorOrderKeyDate      DateTime?
  priorOrderID           String?   @db.VarChar(64)

  receiverIMID           String?
  senderType             String?

  requestTimestamp       DateTime?
  initiator              String?

  leavesQty              Decimal?
  cancelQty              Decimal?

  tradeKeyDate           DateTime?
  tradeID                String?   @db.VarChar(64)

  cancelFlag             Boolean?
  cancelTimestamp        DateTime?

  capacity               String?
  tapeTradeID            String?   @db.VarChar(40)
  marketCenterID         String?

  sideDetailsInd         String?
  buyDetails             Json?
  sellDetails            Json?

  reportingExceptionCode String?
  clearingFirm           Int?
  counterparty           String?

  fillKeyDate            DateTime?
  fulfillmentID          String?   @db.VarChar(64)
  fulfillmentLinkType    String?

  clientDetails          Json?
  firmDetails            Json?

  execution              Execution     @relation(fields: [executionId], references: [id], onDelete: Cascade)


  executionBusinessClassification          ExecutionBusinessClassification   @relation( fields: [executionBusinessClassificationId], references: [id], onDelete: Cascade)

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
   @@index([executionId])
  @@index([executionBusinessClassificationId])
  @@map("execution_cat_events")
}